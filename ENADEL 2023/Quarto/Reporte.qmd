---
title: "Reporte"
author: "Cliodinámica"
format:
  pdf:
    cap-location: "top"
    keep-tex: true
    fig-pos: 'H'
    document:
      tables:
        float: false
    extra_dependencies: ["float"]
    documentclass: article
    latex-engine: xelatex
    toc: false
    toc-depth: 3
    toc-title: "Índice"
    mainfont: "Verdana"
fontsize: 14pt
lang: es
header-includes:
  - \usepackage{xcolor}
  - \usepackage{fontspec}  # Para poder usar Verdana
  - \setmainfont{Verdana}  # Establecer Verdana como fuente principal
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancyhf{} 
  - \cfoot{\thepage}
  - \floatplacement{figure}{H}
  - \floatplacement{table}{H}
  - \usepackage{geometry}
  - \geometry{
      left=1.06cm,
      right=1.06cm,
      top=1.06cm,
      bottom=1.06cm
    }
  - \usepackage{flafter}
  - \raggedbottom
  - \usepackage{placeins}
  - \usepackage{ragged2e}
  - \usepackage{float}
  - \usepackage{setspace}
  - \renewcommand{\familydefault}{\sfdefault}
  - \AtBeginDocument{\renewcommand{\baselinestretch}{1.5}\justifying}
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancyhf{} 
  - \fancyhead[LO,RE]{}
  - \fancyhead[LE,RO]{}
  - \usepackage{xcolor}  # Para el manejo de colores
  - \definecolor{mybgcolor}{HTML}{01376B}  # Definir color personalizado
  - \usepackage{pagecolor}  # Para cambiar el color de fondo
---
\newpage

\pagecolor{mybgcolor} 
\color{white}
::: titlingpage
\centering
\includegraphics[width=0.5\textwidth]{../Logotipo ENADEL/Logotipo ENADEL 2023.png} \vspace{2cm}
:::

\noindent
Ministerio del Trabajo y Previsión Social

División de Políticas de Empleo\\
Subsecretaría del Trabajo



\justifying
El presente documento analiza los resultados de la Encuesta Nacional de Demanda Laboral (ENADEL) 2023, que busca identificar y caracterizar el capital humano requerido por las empresas de los distintos sectores productivos del país, generando información sobre la demanda actual de ocupaciones de las empresas, detectando requisitos y problemas de contratación. Al igual que versiones anteriores de esta encuesta, se puso el foco en dos sectores de actividad económica: Construcción y el sector Agrícola.

\newpage

\pagecolor{white}  % Volver al fondo blanco para el resto del documento
\color{black}


\newpage
\renewcommand{\contentsname}{Índice} 
\tableofcontents

\newpage



 
## Descripción General: Empresas y Trabajadores



```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE, results='asis', fig.align = 'center'}

#Cargar paquetes
pacman::p_load(tidyverse,#universo de paquetes
               haven,# leer archivos stata y spss
               stargazer,# tablas de regresión??
              kableExtra,#Tablas fancy
              scales,#escala porcentaje 
              patchwork,#Combinar gráficos
              bookdown,#Referencias
              showtext,#fuente
              sysfonts)#habilitar fuentes

        

options(OutDec = ",")

#Cargar tablas


porc_region <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 2)
porc_sector <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 3)

  orden_regiones <- c(
    "Arica y Parinacota", "Tarapacá", "Antofagasta", "Atacama", 
    "Coquimbo", "Valparaíso", "Metropolitana", "O'Higgins", 
    "Maule", "Ñuble", "Biobío", "Araucanía", 
    "Los Ríos", "Los Lagos", "Aysén", "Magallanes"
  )

porc_region<- porc_region %>% select(-c("region","empresas", "trabajadores")) 
porc_region <- round(porc_region*100, 2)
rownames(porc_region)<- orden_regiones
```
La muestra de ENADEL 2023 encuesta a 5.820 empresas que suman 485.256 trabajadores (a nivel muestral). Estas representan a 82.052 empresas y 5.611.196 trabajadores a nivel nacional. La @tbl-region muestra  la distribución en las distintas regiones del país, dónde un `r round(porc_region[7, 1],1 )`% de las empresas y un `r round(porc_region[7, 2],1)`% de los trabajadores se encuentran en la región Metropolitana.

\vspace{5mm}

\FloatBarrier
```{r, results='asis'}
#| label: tbl-region
#| tbl-cap: "Resultados de la encuesta" 
#| echo: false
#| error: false
#| message: false
#| warning: false

# Generar la tabla con kable
kable(porc_region, 
      col.names = c("Región", "% Empresas", "% Trabajadores"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>% 
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
           general_title= "")  
 # kable_styling(latex_options = c("hold_position"))


```
\FloatBarrier

La @fig-combined muestra el porcentaje de empresas y trabajadores según tamaño de empresas, utilizando la clasificación por número de trabajadores, cómo por volumen de venta. Con respecto a la primera clasificación, el 74,6% de las empresas tiene menos de 50 trabajadores –acumulando un 23,8% del total– y casi el 50% de los trabajadores están en empresas grandes –que corresponden a un 6,5% del total. Si se analiza según tamaño de ventas, más de la mitad de las empresas tienen un volumen de venta de entre 2.400 y 24.999 UF (“Pequeñas”) y más de un cuarto venden entre 25.000 y 100.000 UF al año (“Mediana”). Sin embargo, casi un tercio de los trabajadores están en empresas grandes (más de 100.000 UF).

\FloatBarrier
```{r, fig.cap="Gráfico combinado de resultados", out.width='100%', fig.align='center', fig.pos='H'}
#| label: fig-combined
#| fig-cap: "Gráfico combinado de resultados"
#| echo: false
#| fig-align: center
#| error: false
#| message: false
#| warning: false


pc_tam<- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 3)

pc_tamvent<- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 4)

#Agregar Verdana
font_add(family = "verdana", regular = "C:/Windows/Fonts/VERDANA.TTF")
#habilitar para ggplot
showtext_auto()

#Gráfico de tamaño según n° de trabajadores----

# Transformar los datos al formato largo para ggplot
df_long <- pc_tam %>%
  pivot_longer(cols = starts_with("pc_"), names_to = "tipo", values_to = "porcentaje")
# Cambiar nombres
df_long$tipo <- recode(df_long$tipo, "pc_empresas" = "Empresas", "pc_trabajadores" = "Trabajadores")

# Gráfico de barras
graf_tam<-ggplot(df_long, aes(x = tipo, y = porcentaje, fill = factor(tam_label, levels = c("Pequeña", "Mediana", "Grande")))) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.5), width = 0.4) +#gráfico de barras
  scale_fill_manual(values = c("Pequeña" = "#005691", "Mediana" = "#01376B", "Grande" = "#002A51")) +#color de leyendas
  geom_text(aes(label = scales::percent(porcentaje, accuracy = 1)),#valor de etiquetas
            position = position_dodge(width = 0.5), vjust = -0.5, size = 2) +#posición de las etiquetas
   scale_y_continuous(labels = scales::percent, limits = c(0, 1)) + #eje y
  labs(title = "Según N° de trabajadores",
       x = NULL,
       y = NULL,
       fill = "") +
  theme_minimal(base_family = "verdana") +
  theme(axis.text.x = element_text(size = 5),
        axis.text.y = element_text(size = 5),
        plot.title = element_text(hjust = 0.5, size = 7.5),
        legend.position = "bottom",
        legend.title = element_text(size = 5), # Ajustar el tamaño del título de la leyenda
    legend.text = element_text(size = 5)    # Ajustar el tamaño del texto de las etiquetas de la leyenda
  ) +
  guides(
    fill = guide_legend(nrow = 2) # Configurar la leyenda para tener 2 filas
  )



#Gráfico de tamaño según n° de ventas----

# Transformar los datos al formato largo para ggplot
df_long <- pc_tamvent %>%
  pivot_longer(cols = starts_with("pc_"), names_to = "tipo", values_to = "porcentaje")
# Cambiar nombres
df_long$tipo <- recode(df_long$tipo, "pc_empresas" = "Empresas", "pc_trabajadores" = "Trabajadores")

# Asignar etiquetas a la variable tam_vent
df_long$tam_vent <- factor(df_long$tam_vent, 
                           levels = c(0, 1, 2, 3, 4), 
                           labels = c("Sin ventas", "Micro", "Pequeña", "Mediana", "Grande"))

# Gráfico de barras
graf_tamvent<-ggplot(df_long, aes(x = tipo, y = porcentaje, fill = factor(tam_vent, levels = c("Sin ventas","Micro","Pequeña", "Mediana", "Grande")))) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.6) +#gráfico de barras
  scale_fill_manual(values = c("Sin ventas"= "#64C3D2","Micro"="#0076B7","Pequeña" = "#005691", "Mediana" = "#01376B", "Grande" = "#002A51")) +#color de leyendas
  geom_text(aes(label = scales::percent(porcentaje, accuracy = 1)),#valor de etiquetas
            position = position_dodge(width = 0.7), vjust = -0.5, size = 2) +#posición de las etiquetas
   scale_y_continuous(labels = scales::percent, limits = c(0, 1)) + #eje y
  labs(title = "Según tamaño de ventas",
       x = NULL,
       y = NULL,
       fill="") +
  theme_minimal(base_family = "verdana")+
  theme(axis.text.x = element_text(size = 5),
        axis.text.y = element_text(size = 5),
        plot.title = element_text(hjust = 0.5, size = 7.5),
        legend.position = "bottom",
        legend.title = element_text(size = 5), # Ajustar el tamaño del título de la leyenda
    legend.text = element_text(size = 5)    # Ajustar el tamaño del texto de las etiquetas de la leyenda
  ) +
  guides(
    fill = guide_legend(nrow = 2) # Configurar la leyenda para tener 2 filas
  )

#Combinar gráficos
graf_combined <- graf_tam + graf_tamvent +
  plot_layout(ncol = 2) +  # Configurar para que los gráficos estén en 2 columnas (lado a lado)
  plot_annotation(
    caption = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
    theme = theme(plot.title = element_text(family = "verdana", size = 14, face = "bold"),
      plot.caption = element_text(family = "verdana", hjust = 0, size = 7.5))
  )

graf_combined


```
\FloatBarrier



```{r, results='asis'}
#| echo: false
#| error: false
#| message: false
#| warning: false

porc_acteco <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 1) %>% select(-c("act_eco","empresas", "trabajadores"))

porc_acteco <- round(porc_acteco*100, 2)

porc_acteco <- porc_acteco %>% arrange(desc(pc_trabajadores))

orden_acteco <-c("Comercio", "Construcción", "Servicios administrativos y de apoyo", 
  "Industria manufacturera", "Actividades profesionales", "Silvoagropecuario", 
  "Transporte y almacenamiento", "Administración pública", "Alojamiento y de servicio de comidas", 
  "Información y comunicaciones", "Actividades inmobiliarias", "Actividades financieras y de seguros", 
  "Pesca y acuicultura")

rownames(porc_acteco)<- orden_acteco

```

Al revisar la distribución por sector de actividad económica @tbl-acteco se tiene que una de cada cinco empresas pertenece al sector de Comercio, seguido por el sector Construcción (`r round(porc_acteco[2,1], 1)`%) y el sector de Industrias Manufactureras (11,4%). Con respecto al volumen de trabajadores, el sector Comercio también lidera (17,8%) seguido por el sector Construcción (14,4%) y el sector de Servicios Administrativos y de Apoyo que, siendo sector intensivo en trabajo, un 9,1% de las empresas acumula el 13,5% de trabajadores y trabajadoras.

\FloatBarrier
```{r, results='asis'}
#| label: tbl-acteco
#| tbl-cap: "Empresas y trabajadores según sector de actividad económica" 
#| echo: false
#| error: false
#| message: false
#| warning: false

# Generar la tabla con kable
kable(porc_acteco,
      col.names = c("Actividad Económica", "% Empresas", "% Trabajadores"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>% 
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
            general_title= "") 
   #kable_styling(latex_options = c("hold_position"))



```
\FloatBarrier




### Contratados en los últimos 12 meses
```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false

contratos_totales <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 5) 

contratos_totales<- contratos_totales %>% mutate(Si= round((convacu12_1/tot_empresas)*100,1),
                                                 No= round((convacu12_2/tot_empresas)*100,1))
contratos_totales<- contratos_totales %>%select(c( "sector_label","Si", "No"))

# Cambiar el orden de las columnas
contratos_totales <- contratos_totales %>% select("sector_label","Si", "No") %>% 
  rename("Sector Actividad Económica" = sector_label)
  
 

```

El 87,1% de las empresas declaró que sí contrató personas nuevas durante los últimos 12 meses, mientras que el 12,9% declara que no contrató personas nuevas durante el mismo período. La @tbl-contratos_totales muestra la proporción de empresas, según sector de actividad económica, que tuvieron contrataciones nuevas durante los últimos 12 meses. El `r round(contratos_totales[12,2],1)`%  de las empresas del sector de pesca y acuicultura respondieron afirmativamente, mientras que el sector con menor proporción fue el de Actividades Inmobiliarias, dónde el 24,9% de firmas no tuvieron contrataciones durante los últimos 12 meses.

\FloatBarrier
```{r}
#| label: tbl-contratos_totales
#| tbl-cap: "Porcentaje de empresas que contrataron en los últimos 12 meses por sector económico" 
#| echo: false
#| error: false
#| message: false
#| warning: false



# Generar la tabla con kable
kable(contratos_totales,
      col.names = c("Actividad Económica", "% Si", "% No"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>% 
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
            general_title= "") 
  #kable_styling(latex_options = c("hold_position"))
                                                
```

\FloatBarrier

##### Contrataciones por ocupación

```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false

contratados_u12 <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 6) 

contratados_u12<- contratados_u12 %>% filter(cv<0.20) %>% arrange(desc(contratadosu12)) %>% head(.,11)

contratados_u12<- contratados_u12 %>% mutate(contratadosu12= round((contratadosu12),0),
                                                 cv= round((cv)*100,1))

contratados_u12<- contratados_u12 %>%select(c("oficio4", "oficio_label","contratadosu12", "cv"))%>% rename("CIUO 08" = oficio4,
                                              "Glosa"=oficio_label,
                                              "Contratados"=contratadosu12,
                                              "CV"=cv
                                              )

# Cambiar nombres de las columnas
#contratados_u12 <- contratados_u12 


```
Se contrataron cargos^[Contrataciones señaladas para los módulos de “Directores y gerentes”, “Jefatura/ADP”, “Ocupaciones Elementales” y “Otros Cargos”.] nuevos en 354 ocupaciones (representando a 1.206.992 contrataciones totales en los últimos 12 meses, cv = 6,8%), sin embargo, la @tbl-contratados_u12 sólo muestra aquellas para las cuáles el coeficiente de variación es menor a 20%^[La convención es considerar cómo robustas estimaciones con un cv menor al 15%. Dado que estas son pocas, se presentan todas las ocupaciones con un cv menor a 20%.].
Las ocupaciones con más contratos en los últimos 12 meses fueron "`r contratados_u12[1,2]`", "`r contratados_u12[2,2]`"  y "`r contratados_u12[3,2]`".

```{r}
#| label: tbl-contratados_u12
#| tbl-cap: "Contratados últimos 12 meses, por ocupación." 
#| echo: false
#| error: false
#| message: false
#| warning: false



# Generar la tabla con kable
kable(contratados_u12,
      col.names = c("CIUO_08", "Glosa", "Contratados", "cv"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>%
  column_spec(2, width = "11cm") %>% 
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
            general_title= "") 
                                                
```

\newpage

##### Contrataciones por ocupación: Sector Construcción


```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false

contratados_u12_constru <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 8) 

contratados_u12_constru<- contratados_u12_constru %>% 
  mutate(contratados_u12= round(contratadosu12/sum(contratadosu12)*100,1)) %>% 
  arrange(desc(contratadosu12)) %>% select("cargo","contratados_u12")

```

En el módulo del sector Construcción se consulta sobre las contrataciones de 25 cargos específicos, con un total de 365.712 contrataciones en los últimos 12 meses (cv=29,2%). La @tbl-contratados_u12_constru muestra la proporción de contratados por cargo, con respecto al total de este módulo. El cargo de "`r contratados_u12_constru[1,1]`"  es el que concentra la mayor cantidad de contrataciones, seguido por "`r contratados_u12_constru[2,1]`" y por "`r contratados_u12_constru[3,1]`".
```{r}
#| label: tbl-contratados_u12_constru
#| tbl-cap: "Proporción de contrataciones por ocupación, sector construcción." 
#| echo: false
#| error: false
#| message: false
#| warning: false



# Generar la tabla con kable
kable(contratados_u12_constru,
      col.names = c("Cargo Construcción", "%"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>%
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
            general_title= "") 
                                                
```


##### Contrataciones por ocupación: Sector Agrícola

```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false

contratados_u12_agricola <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 9) 

contratados_u12_agricola<- contratados_u12_agricola %>% 
  mutate(contratados_u12= round(contratadosu12/sum(contratadosu12)*100,1)) %>% 
  arrange(desc(contratadosu12)) %>% select("cargo","contratados_u12")
```

En el módulo del sector Agrícola se consulta sobre las contrataciones de 15 cargos específicos, con un total de 321.395 contrataciones en los últimos 12 meses (cv=21,6%), cuya distribución en los distintos cargos se muestra en la @tbl-contratados_u12_agricola. Las ocupaciones de "`r contratados_u12_agricola[1,1]`" y "`r contratados_u12_agricola[2,1]`" son las que lideran las contrataciones durante los últimos 12 meses.


```{r}
#| label: tbl-contratados_u12_agricola
#| tbl-cap: "Proporción de contrataciones por ocupación, sector agrícola" 
#| echo: false
#| error: false
#| message: false
#| warning: false



# Generar la tabla con kable
kable(contratados_u12_agricola,
      col.names = c("Cargo Agrícola", "%"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>%
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
            general_title= "") 
```
### Vacantes en los últimos 12 meses



```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false

vacantes_totales_sector <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 10) 

#Recodificación
vacantes_totales_sector<- vacantes_totales_sector %>% 
  mutate(Si= round(vacnollen_1/tot_empresas*100,1),
         No=round(vacnollen_2/tot_empresas*100,1),
         a2=case_when(a2==1~"Actividades profesionales",
                      a2==2~"Actividades financieras y de seguros",
                      a2==3~"Actividades inmobiliarias",
                      a2==4~"Administración pública",
                      a2==5~"Alojamiento y de servicio de comidas",
                      a2==6~"Comercio",
                      a2==7~"Construcción",
                      a2==8~"Industria manufacturera",
                      a2==9~"Información y comunicaciones",
                      a2==10 ~"Servicios administrativos y de apoyo",
                      a2==11 ~"Silvoagropecuario",
                      a2==12 ~"Pesca y acuicultura",
                      a2==13 ~"Transporte y almacenamiento")) %>% 
  arrange(desc(Si)) %>% select("a2","Si","No")

```
El 72,05% de las empresas declaró que sí tuvo vacantes no llenadas durante los últimos 12 meses, mientras que el 27,95% declara que no tuvo vacantes no llenadas durante el mismo período.

La @tbl-vacantes_totales_sector muestra la proporción de empresas, según sector de actividad económica, que tuvieron vacantes no llenadas durante los últimos 12 meses. El `r vacantes_totales_sector[1,2]`%  de las empresas del sector de "`r vacantes_totales_sector[1,1]`"  tuvieron vacantes no llenadas, lo mismo ocurre con el `r vacantes_totales_sector[2,2]`%  de las personas jurídicas del sector de "`r vacantes_totales_sector[2,1]`"  y el `r vacantes_totales_sector[3,2]`%  del sector de "`r vacantes_totales_sector[3,1]`". Por otro lado, el sector de actividad económica con un menor porcentaje de empresas que tuvieron vacantes no llenadas fue el "`r vacantes_totales_sector[13,1]`".

```{r}
#| label: tbl-vacantes_totales_sector
#| tbl-cap: "Porcentaje de empresas con vacantes no cubiertas"
#| echo: false
#| error: false
#| message: false
#| warning: false



# Generar la tabla con kable
kable(vacantes_totales_sector,
      col.names = c("Sector Actividad Económica", "% Sí", "% No"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>%
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
            general_title= "") 
```

Durante el resto de esta sección se hará referencia a las ocupaciones que tengan vacantes sin llenar durante los últimos 12 meses como **ocupaciones de difícil cobertura**.

\newpage

##### Ocupaciones de difícil cobertura


```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false

vacantes_tot <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 11)

vacantes_tot <- vacantes_tot %>% filter(cv<0.4) %>% 
  group_by(oficio4, oficio_label) %>%
  mutate(vacantesu12 = sum(vacantesu12, na.rm = TRUE),  # Suma de vacantes
    cv = sum(cv * vacantesu12, na.rm = TRUE) / sum(vacantesu12, na.rm = TRUE)) %>%
  summarise(oficio4, oficio_label,vacantesu12=round(vacantesu12,0),cv=round(cv*100,1)) %>% 
  arrange(desc(vacantesu12)) %>% 
  ungroup() 


#HAY PROBLEMAS PARA REPLICAR LA TABLA 8:Ocupaciones de difícil cobertura.
#No calzan los n°s, pero se parecen, no hay tantos casos como muestran en el informe.

```

Se declararon vacantes^[Vacantes señaladas para los módulos de “Directores y gerentes”, “Jefatura/ADP”, “Ocupaciones Elementales” y “Otros Cargos”.] sin llenar en 215 ocupaciones (68.365 vacantes, cv=12,3%), sin embargo, la @tbl-vacantes_tot sólo muestra aquellas para las cuáles el coeficiente de variación es menor a 40%^[La convención es considerar cómo robustas estimaciones con un cv menor al 15%. Dado que esto no se cumple, se presentan todas las ocupaciones con un cv menor a 40%.]. La tabla completa con todas las ocupaciones de difícil cobertura se puede encontrar en el **Apéndice A: Ocupaciones de Difícil Cobertura**.

```{r}
#| label: tbl-vacantes_tot
#| tbl-cap: "Ocupaciones de difícil cobertura, ENADEL 2023."
#| echo: false
#| error: false
#| message: false
#| warning: false



# Generar la tabla con kable
kable(vacantes_tot,
      col.names = c("CIUO 08", "Glosa", "Vacantes", "cv"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>%
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
            general_title= "") 
```

La ocupación más demandadas que tiene difícil cobertura es  “`r vacantes_tot[1,2]`”, con más de 14 mil vacantes; seguido de lejos por “`r vacantes_tot[2,2]`”, “`r vacantes_tot[3,2]`” y “`r vacantes_tot[4,2]`”, con `r vacantes_tot[2,3]`, `r vacantes_tot[3,3]` y `r vacantes_tot[4,3]` vacantes, respectivamente.

```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false

vacantes_region <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 15)



vacantes_region<- vacantes_region %>% select(-c("se","cv", "orden")) 
vacantes_region<- vacantes_region %>% select(region_trab,oficio_label, oficio4,vacantesu12)

vacantes_region<- vacantes_region %>% mutate(vacantesu12= round(vacantesu12,0))

vacantes_region<- vacantes_region %>% mutate(region_trab= case_when(region_trab==1~ "Arica y Parinacota",
                                                                    region_trab==2~ "Tarapacá",
                                                                    region_trab==3~ "Antofagasta",
                                                                    region_trab==4~ "Atacama",
                                                                    region_trab==5~ "Coquimbo",
                                                                    region_trab==6~ "Valparaíso",
                                                                    region_trab==7~ "Metropolitana",
                                                                    region_trab==8~ "O'Higgins",
                                                                    region_trab==9~ "Maule",
                                                                    region_trab==10~ "Ñuble",
                                                                    region_trab==11~ "Biobío",
                                                                    region_trab==12~ "Araucanía",
                                                                    region_trab==13~ "Los Ríos",
                                                                    region_trab==14~ "Los Lagos",
                                                                    region_trab==15~ "Aysén",
                                                                    region_trab==16~ "Magallanes"
                                                                    ) )

```

La @tbl-vacantes_region muestra la ocupación de difícil cobertura con mayor cantidad de vacantes por región dónde, si bien se confirma la prevalencia de “Obreros de explotaciones agrícolas” en 7 regiones, también saltan a la vista otros patrones como la demanda del rubro de la construcción hacia el norte y de la industria manufacturera en el Maule y la Araucanía.

```{r}
#| label: tbl-vacantes_region
#| tbl-cap: "Ocupación de difícil cobertura con mayor cantidad de vacantes, por región."
#| echo: false
#| error: false
#| message: false
#| warning: false



# Generar la tabla con kable
kable(vacantes_region,
      col.names = c("Región", "Ocupación", "CIUO 08", "Vacantes"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>%
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
            general_title= "") 

```



```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false


vacantes_tam <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 16)
vacantes_tamvent <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 17)


vacantes_tam<- vacantes_tam %>% select(-c("se","cv", "orden")) 
vacantes_tamvent<- vacantes_tamvent %>% select(-c("se","cv", "orden")) 

vacantes_tam<- vacantes_tam %>% select(tam_val,oficio_label, oficio4,vacantesu12)
vacantes_tamvent<- vacantes_tamvent %>% select(tam_val=tam_vent,oficio_label, oficio4,vacantesu12)

vacantes_tam<- vacantes_tam %>% mutate(vacantesu12= round(vacantesu12,0),
                                       tam_val=case_when(tam_val==2 ~ "Pequeña (<50)",
                                                         tam_val==3 ~ "Mediana (50-199)",
                                                         tam_val==4 ~ "Grande (>=200)")) 

vacantes_tamvent<- vacantes_tamvent %>% mutate(vacantesu12= round(vacantesu12,0),
                                               tam_val= case_when(tam_val==0 ~ "Sin ventas",
                                                         tam_val==1 ~ "Micro (< 2.400 UF)",
                                                         tam_val==2 ~ "Pequeña (2.400-25.000 UF)",
                                                         tam_val==3 ~ "Mediana (25.000-100.000 UF)",
                                                         tam_val==4 ~ "Grande (>100.000 UF)"))

#Juntar tablas
vacantes_tamano <- rbind(vacantes_tam,vacantes_tamvent)

# agregar columna "Según n° de trabajadores" y "Según ventas"
vacantes_tamano <- data.frame(
  Categoria = c(rep("", 3), rep("", 5)),
  vacantes_tamano) %>% select(Categoria, tam_val, oficio_label, oficio4, vacantesu12)


```
Al indagar según el tamaño de empresa (@tbl-vacantes_tamano), "`r vacantes_tamano[1,3]`" prevalece en las empresas pequeñas (tanto por número de trabajadores como por tamaño de venta) y "`r vacantes_tamano[3,3]`" en las empresas con más de 200 trabajadores y en aquellas con ventas entre 25 y 100 mil UF. La ocupación  "`r vacantes_tamano[8,3]`" es la más difícil de cubrir en empresas de entre 50 y 199 trabajadores (mediana) y en aquellas que tienen ventas superiores a las 10 mil UF.

```{r}
#| label: tbl-vacantes_tamano
#| tbl-cap: "Ocupación de difícil cobertura con mayor cantidad de vacantes por tamaño de empresa."
#| echo: false
#| error: false
#| message: false
#| warning: false



# Generar la tabla con kable
kable(vacantes_tamano,
      col.names = c("Categoría", "Tamaño Empresa", "Ocupación", "CIUO 08", "Vacantes"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>%
    column_spec(3, width = "7cm") %>%
  column_spec(1, bold = TRUE, width = "4cm") %>%  # Formatear la primera columna
  group_rows("\\textbf{Según n° de trabajadores}", 1, 3, latex_align = "l", escape = FALSE) %>%
  group_rows("\\textbf{Según ventas}", 4, 8, latex_align = "l", escape = FALSE) %>%
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
            general_title= "") 

```

```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false

vacantes_sector <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = 14)

#Recodificación
vacantes_sector<- vacantes_sector %>% 
  mutate(a2=case_when(a2==1~"Actividades profesionales",
                      a2==2~"Actividades financieras y de seguros",
                      a2==3~"Actividades inmobiliarias",
                      a2==4~"Administración pública",
                      a2==5~"Alojamiento y de servicio de comidas",
                      a2==6~"Comercio",
                      a2==7~"Construcción",
                      a2==8~"Industria manufacturera",
                      a2==9~"Información y comunicaciones",
                      a2==10 ~"Servicios administrativos y de apoyo",
                      a2==11 ~"Silvoagropecuario",
                      a2==12 ~"Pesca y acuicultura",
                      a2==13 ~"Transporte y almacenamiento"),
         vacantesu12= round(vacantesu12,0)) %>% 
  select(a2,oficio_label,oficio4,vacantesu12)
 

```
Al analizar las ocupaciones de difícil cobertura según el sector de actividad económica, como se muestra en la @tbl-vacantes_sector, se vuelve a confirmar la dificultad para llenar vacantes de “Obreros de explotaciones agrícolas”, pero también surgen otras ocupaciones relevantes como "`r vacantes_sector[2,2]`"  “Vendedores y asistentes de venta de tiendas, almacenes y puestos de mercado” que es la ocupación con más vacantes sin llenar en los sectores de "`r vacantes_sector[2,1]`"  y "`r vacantes_sector[6,1]`".

```{r}
#| label: tbl-vacantes_sector
#| tbl-cap: "Ocupación de difícil cobertura con mayor cantidad de vacantes por sector de actividad económica."
#| echo: false
#| error: false
#| message: false
#| warning: false


# Generar la tabla con kable
kable(vacantes_sector,
      col.names = c("Sector Actividad Económica", "Ocupación", "CIUO 08", "Vacantes"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>%
  column_spec(2, width = "7cm") %>%
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos. Nota: para seleccionar la ocupación de difícil cobertura con mayor cantidad de vacantes sólo se tomó en cuenta la magnitud de la estimación, sin considerar indicadores de robustez cómo el coeficiente de variación.",
            general_title= "") 

```


##### Ocupaciones de Difícil Cobertura: Sector Construcción

```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false

vacantes_constru <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = "vacantes_constr")

#Recodificación
vacantes_constru<- vacantes_constru %>% 
  mutate(porcentaje= round((vacantesu12/sum(vacantesu12))*100,0),
         cv=round(cv*100,0),
         vacantesu12= round(vacantesu12,0))%>% 
  select(cargo,vacantesu12,porcentaje, cv) %>% arrange(desc(vacantesu12))



# Crear fila de totales
totales <- vacantes_constru %>%summarise(cargo = "Total",
                                         vacantesu12 = sum(vacantesu12),
                                         porcentaje = sum(porcentaje), # Suma de porcentajes para verificar que sea 100%
                                         cv = NA_real_)  # NA porque no tiene sentido calcular un total para CV

# Unir la fila de totales a la tabla original
vacantes_constru <- bind_rows(vacantes_constru, totales) %>% filter(vacantesu12>0)
 
```

La @tbl-vacantes_constru muestra todos los cargos del sector Construcción sobre los que se consulta en la encuesta, indicando el número de vacantes, el porcentaje que estas representan del total, y el coeficiente de variación. Se muestran todas las vacantes independiente de la robustez estadística de la estimación.

La ocupación de “`r vacantes_constru[1,1]`” es la más demandada, con `r vacantes_constru[1,2]` vacantes, seguida de “`r vacantes_constru[2,1]`” con `r vacantes_constru[2,2]` vacantes.

```{r}
#| label: tbl-vacantes_constru
#| tbl-cap: "Ocupaciones de difícil cobertura, sector construcción."
#| echo: false
#| error: false
#| message: false
#| warning: false


# Generar la tabla con kable
kable(vacantes_constru,
      col.names = c("Cargo Construcción", "Vacantes", "% del total", "CV"),
      format = "latex", 
      booktabs = TRUE) %>% 
  kable_classic(full_width = FALSE, html_font = "Verdana") %>%
  column_spec(2, width = "7cm") %>%
  footnote(general = "Fuente: Elaboración propia utilizando datos de ENADEL 2023, datos expandidos.",
            general_title= "") 

```

##### Ocupaciones de Difícil Cobertura: Sector Agrícola
```{r}
#| echo: false
#| error: false
#| message: false
#| warning: false

vacantes_agro <- readxl::read_xlsx("../Tablas/porcentajes.xlsx", sheet = "vacantes_agro")

#Recodificación
vacantes_agro<- vacantes_agro %>% 
  mutate(porcentaje= round((vacantesu12/sum(vacantesu12))*100,0),
         cv=round(cv*100,0),
         vacantesu12= round(vacantesu12,0))%>% 
  select(cargo,vacantesu12,porcentaje, cv) %>% arrange(desc(vacantesu12))



# Crear fila de totales
totales <- vacantes_agro %>%summarise(cargo = "Total",
                                         vacantesu12 = sum(vacantesu12),
                                         porcentaje = sum(porcentaje), # Suma de porcentajes para verificar que sea 100%
                                         cv = NA_real_)  # NA porque no tiene sentido calcular un total para CV

# Unir la fila de totales a la tabla original
vacantes_agro <- bind_rows(vacantes_agro, totales) %>% filter(vacantesu12>0)
 
```

La Tabla 13 muestra todos los cargos del sector Agrícola sobre los que se consulta en la encuesta, indicando el número de vacantes, el porcentaje que estas representan del total, y el coeficiente de variación. Se muestran todas las vacantes independiente de la robustez estadística de la estimación.

El cargo “Obrero agrícola de poda, raleo” es el más demandado, con 2.234 vacantes, “Obrero agrícola de cosecha” con 1.921 vacantes y “Obrero agrícola de riego, aplicación de agroquímicos” con 1.597 vacantes.



```{r}
Ocupaciones de difícil cobertura, sector agrícola
```

### Dificultades para la contratación

##### Dificultades para la contratación: Sector Construcción 

##### Dificultades para la contratación: Sector Agrícola

### Educación y experiencia

### Canales de reclutamiento

### Conocimiento de instituciones y programas

### Apéndice A: Ocupaciones de Difícil Cobertura


